# Lane Projection
This code:
- Loads the output of the dataset loader
- Performs 2D-to-3D projection (using thesis and alternate pipelines)
- Generates runtime data
- Identifies dataset outliers
- Compiles dataset-wide and run-wide results for ease of analysis
- Performs analytics, generating metrics, tables, and figures used in the thesis paper
<br>This code outputs the following files:
- Log files (summary logs, per-sequence logs, compiler logs, analysis logs)
- Runtime data (for all solutions)
- Outlier file, including point and lane outliers
- Per-run 3D projections, including:
  - Per-method outputs (thesis solution and 4 alternates),
  - Evaluation outputs, being compiled data
- Output metrics, figures, and tables


## Repository Structure
```
msc-thesis-lane-projection/
│
├── README.md
├── .gitignore
│
├── dataset_loader/
│   ...
│
└── lane_projection/
    ├── README.md             ← (this file)
    ├── requirements.txt
    ├── once_config.yaml
    ├── main_runner.ipynb
    ├── postfilter_outliers.ipynb
    ├── results_compiler.ipynb
    ├── analysis.ipynb
    └── logger.py
```
The loader is designed to be self-contained and requires no modification unless dataset paths change or alternate configuration variables are desired.

## Running the Program
First, run the dataset loader pipeline (see `dataset_loader/`).
Reconfigure the config file to match the dataset loader formats as appropriate, selecting which solutions to enable.
Install the requirements.
Run the following Jupyter notebooks in Jupyter (or a Jupyter-compatible environment, such as Visual Studio Code's).<br>
- Open the notebook `main_runner.ipynb` and run all cells in sequential order to produce rotation output.<br>
- Open the notebook `postfilter_outliers.ipynb` and run all cells in sequential order to identify outliers.<br>
- Open the notebook `results_compiler.ipynb` and run all cells in sequential order to compile all of the runtime results.<br>
- Open the notebook `analysis.ipynb`, run the select cells to generate various outputs (can be run non-sequentially).

## Output Folder Structure
Below is an example of the folder structure with non-analysis outputs (as used in and generated by the thesis):

```
lane_projection/
├── README.md             ← (this file)
├── requirements.txt
├── once_config.yaml
├── main_runner.ipynb
├── postfilter_outliers.ipynb
├── results_compiler.ipynb
├── analysis.ipynb
├── logger.py
├── output/               ← (generated)
│   ├── summary_log
│   ├── analytics_builder_log.txt
│   ├── runtime_data.json
│   ├── postfilter.json
│   └── <run id>/
|       ├── log_<run id>.txt
|       ├── <thesis output folder name>/
|       |   └── <file id>_<lane index, 0+>.pcd
|       ├── <constant height pinhole folder name>/
|       |   └── <file id>_<lane index, 0+>.pcd
|       ├── <ground plane pinhole folder name>/
|       |   └── <file id>_<lane index, 0+>.pcd
|       ├── <lidar matching folder name>/
|       |   └── <file id>_<lane index, 0+>.pcd
|       ├── <lidar + pinhole folder name>/
|       |   └── <file id>_<lane index, 0+>.pcd
|       └── evaluation/
|           ├── <thesis output>_eval.json
|           ├── <constant height pinhole output>_eval.json
|           ├── <ground plane pinhole output>_eval.json
|           ├── <lidar matching output>_eval.json
|           └── <lidar + pinhole output>_eval.json
└── figures/              ← (generated)
    ... (various output folders and files)
```

## Config File Overview (config.yaml)

The YAML file contains four sections:

1. runtime: various runtime parameters, including run id/file id constraints and execution paths.

2. output: output base directory, folders, and booleans to run different methods (thesis.

3. data: paths to the data loader output (lidar, camera, 2D and 3D detections, calibration, and config).

4. lane_detection_config: configuration variables based on the 2D detection module.

5. ground_plane_ransac: runtime hyperparameters for plane fitting.

6. depth_map: runtime hyperparameters for depth map generation and usage.

7. intrinsic_plane_projection: runtime hyperparameters for intrinsic projections.

8. projection_mapping: runtime hyperparameters for the final 2D-to-3D mapping scheme.

9. results_analytics: paths and hyperparameters for postfiltering and analytics.

Each entry has a brief inline comment documenting its purpose.
